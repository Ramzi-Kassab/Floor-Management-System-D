{% load static humanize %}
{# Widget partial template for saved dashboards - supports all customization options #}

<div class="widget-container p-6 transition-all duration-200
            {% if widget.size == 'large' %}md:col-span-2{% endif %}
            {% if widget.size == 'full' %}md:col-span-2 lg:col-span-3{% endif %}
            {% comment %}Border radius{% endcomment %}
            {% if widget.border_radius == 'square' %}rounded-none{% elif widget.border_radius == 'pill' %}rounded-3xl{% else %}rounded-xl{% endif %}
            {% comment %}Background style - Solid{% endcomment %}
            {% if widget.bg_style == 'solid' %}bg-white dark:bg-gray-800 shadow-md hover:shadow-lg{% endif %}
            {% comment %}Background style - Flat{% endcomment %}
            {% if widget.bg_style == 'flat' %}bg-gray-50 dark:bg-gray-800/50{% endif %}
            {% comment %}Background style - Glass{% endcomment %}
            {% if widget.bg_style == 'glass' %}backdrop-blur-sm
                {% if widget.color == 'blue' %}bg-blue-50/80 dark:bg-blue-900/20{% elif widget.color == 'indigo' %}bg-indigo-50/80 dark:bg-indigo-900/20{% elif widget.color == 'purple' %}bg-purple-50/80 dark:bg-purple-900/20{% elif widget.color == 'pink' %}bg-pink-50/80 dark:bg-pink-900/20{% elif widget.color == 'red' %}bg-red-50/80 dark:bg-red-900/20{% elif widget.color == 'orange' %}bg-orange-50/80 dark:bg-orange-900/20{% elif widget.color == 'amber' %}bg-amber-50/80 dark:bg-amber-900/20{% elif widget.color == 'yellow' %}bg-yellow-50/80 dark:bg-yellow-900/20{% elif widget.color == 'lime' %}bg-lime-50/80 dark:bg-lime-900/20{% elif widget.color == 'green' %}bg-green-50/80 dark:bg-green-900/20{% elif widget.color == 'teal' %}bg-teal-50/80 dark:bg-teal-900/20{% elif widget.color == 'cyan' %}bg-cyan-50/80 dark:bg-cyan-900/20{% elif widget.color == 'sky' %}bg-sky-50/80 dark:bg-sky-900/20{% elif widget.color == 'slate' %}bg-slate-50/80 dark:bg-slate-900/20{% elif widget.color == 'gray' %}bg-gray-50/80 dark:bg-gray-800/50{% else %}bg-blue-50/80 dark:bg-blue-900/20{% endif %}
            {% endif %}
            {% comment %}Background style - Filled with intensity{% endcomment %}
            {% if widget.bg_style == 'filled' %}
                {% if widget.color_intensity == 'light' %}
                    {% if widget.color == 'blue' %}bg-blue-100 dark:bg-blue-900/40{% elif widget.color == 'indigo' %}bg-indigo-100 dark:bg-indigo-900/40{% elif widget.color == 'purple' %}bg-purple-100 dark:bg-purple-900/40{% elif widget.color == 'pink' %}bg-pink-100 dark:bg-pink-900/40{% elif widget.color == 'red' %}bg-red-100 dark:bg-red-900/40{% elif widget.color == 'orange' %}bg-orange-100 dark:bg-orange-900/40{% elif widget.color == 'amber' %}bg-amber-100 dark:bg-amber-900/40{% elif widget.color == 'yellow' %}bg-yellow-100 dark:bg-yellow-900/40{% elif widget.color == 'lime' %}bg-lime-100 dark:bg-lime-900/40{% elif widget.color == 'green' %}bg-green-100 dark:bg-green-900/40{% elif widget.color == 'teal' %}bg-teal-100 dark:bg-teal-900/40{% elif widget.color == 'cyan' %}bg-cyan-100 dark:bg-cyan-900/40{% elif widget.color == 'sky' %}bg-sky-100 dark:bg-sky-900/40{% elif widget.color == 'slate' %}bg-slate-100 dark:bg-slate-900/40{% elif widget.color == 'gray' %}bg-gray-100 dark:bg-gray-800{% else %}bg-blue-100 dark:bg-blue-900/40{% endif %}
                {% elif widget.color_intensity == 'strong' %}
                    {% if widget.color == 'blue' %}bg-blue-500 dark:bg-blue-600 text-white{% elif widget.color == 'indigo' %}bg-indigo-500 dark:bg-indigo-600 text-white{% elif widget.color == 'purple' %}bg-purple-500 dark:bg-purple-600 text-white{% elif widget.color == 'pink' %}bg-pink-500 dark:bg-pink-600 text-white{% elif widget.color == 'red' %}bg-red-500 dark:bg-red-600 text-white{% elif widget.color == 'orange' %}bg-orange-500 dark:bg-orange-600 text-white{% elif widget.color == 'amber' %}bg-amber-500 dark:bg-amber-600 text-gray-900{% elif widget.color == 'yellow' %}bg-yellow-500 dark:bg-yellow-600 text-gray-900{% elif widget.color == 'lime' %}bg-lime-500 dark:bg-lime-600 text-gray-900{% elif widget.color == 'green' %}bg-green-500 dark:bg-green-600 text-white{% elif widget.color == 'teal' %}bg-teal-500 dark:bg-teal-600 text-white{% elif widget.color == 'cyan' %}bg-cyan-500 dark:bg-cyan-600 text-white{% elif widget.color == 'sky' %}bg-sky-500 dark:bg-sky-600 text-white{% elif widget.color == 'slate' %}bg-slate-500 dark:bg-slate-600 text-white{% elif widget.color == 'gray' %}bg-gray-500 dark:bg-gray-600 text-white{% else %}bg-blue-500 dark:bg-blue-600 text-white{% endif %}
                {% else %}
                    {% if widget.color == 'blue' %}bg-blue-200 dark:bg-blue-800/60{% elif widget.color == 'indigo' %}bg-indigo-200 dark:bg-indigo-800/60{% elif widget.color == 'purple' %}bg-purple-200 dark:bg-purple-800/60{% elif widget.color == 'pink' %}bg-pink-200 dark:bg-pink-800/60{% elif widget.color == 'red' %}bg-red-200 dark:bg-red-800/60{% elif widget.color == 'orange' %}bg-orange-200 dark:bg-orange-800/60{% elif widget.color == 'amber' %}bg-amber-200 dark:bg-amber-800/60{% elif widget.color == 'yellow' %}bg-yellow-200 dark:bg-yellow-800/60{% elif widget.color == 'lime' %}bg-lime-200 dark:bg-lime-800/60{% elif widget.color == 'green' %}bg-green-200 dark:bg-green-800/60{% elif widget.color == 'teal' %}bg-teal-200 dark:bg-teal-800/60{% elif widget.color == 'cyan' %}bg-cyan-200 dark:bg-cyan-800/60{% elif widget.color == 'sky' %}bg-sky-200 dark:bg-sky-800/60{% elif widget.color == 'slate' %}bg-slate-200 dark:bg-slate-800/60{% elif widget.color == 'gray' %}bg-gray-200 dark:bg-gray-700{% else %}bg-blue-200 dark:bg-blue-800/60{% endif %}
                {% endif %}
            {% endif %}
            {% comment %}Border accent - Top{% endcomment %}
            {% if widget.border_style == 'top' %}
                {% if widget.border_size == 'thin' %}border-t-2{% elif widget.border_size == 'thick' %}border-t-8{% else %}border-t-4{% endif %}
                {% if widget.color == 'blue' %}border-t-blue-500{% elif widget.color == 'indigo' %}border-t-indigo-500{% elif widget.color == 'purple' %}border-t-purple-500{% elif widget.color == 'pink' %}border-t-pink-500{% elif widget.color == 'red' %}border-t-red-500{% elif widget.color == 'orange' %}border-t-orange-500{% elif widget.color == 'amber' %}border-t-amber-500{% elif widget.color == 'yellow' %}border-t-yellow-500{% elif widget.color == 'lime' %}border-t-lime-500{% elif widget.color == 'green' %}border-t-green-500{% elif widget.color == 'teal' %}border-t-teal-500{% elif widget.color == 'cyan' %}border-t-cyan-500{% elif widget.color == 'sky' %}border-t-sky-500{% elif widget.color == 'slate' %}border-t-slate-500{% elif widget.color == 'gray' %}border-t-gray-500{% else %}border-t-blue-500{% endif %}
            {% endif %}
            {% comment %}Border accent - Left{% endcomment %}
            {% if widget.border_style == 'left' %}
                {% if widget.border_size == 'thin' %}border-l-2{% elif widget.border_size == 'thick' %}border-l-8{% else %}border-l-4{% endif %}
                {% if widget.color == 'blue' %}border-l-blue-500{% elif widget.color == 'indigo' %}border-l-indigo-500{% elif widget.color == 'purple' %}border-l-purple-500{% elif widget.color == 'pink' %}border-l-pink-500{% elif widget.color == 'red' %}border-l-red-500{% elif widget.color == 'orange' %}border-l-orange-500{% elif widget.color == 'amber' %}border-l-amber-500{% elif widget.color == 'yellow' %}border-l-yellow-500{% elif widget.color == 'lime' %}border-l-lime-500{% elif widget.color == 'green' %}border-l-green-500{% elif widget.color == 'teal' %}border-l-teal-500{% elif widget.color == 'cyan' %}border-l-cyan-500{% elif widget.color == 'sky' %}border-l-sky-500{% elif widget.color == 'slate' %}border-l-slate-500{% elif widget.color == 'gray' %}border-l-gray-500{% else %}border-l-blue-500{% endif %}
            {% endif %}
            {% comment %}Border accent - Full{% endcomment %}
            {% if widget.border_style == 'full' %}
                {% if widget.border_size == 'thin' %}border{% elif widget.border_size == 'thick' %}border-4{% else %}border-2{% endif %}
                {% if widget.color == 'blue' %}border-blue-500{% elif widget.color == 'indigo' %}border-indigo-500{% elif widget.color == 'purple' %}border-purple-500{% elif widget.color == 'pink' %}border-pink-500{% elif widget.color == 'red' %}border-red-500{% elif widget.color == 'orange' %}border-orange-500{% elif widget.color == 'amber' %}border-amber-500{% elif widget.color == 'yellow' %}border-yellow-500{% elif widget.color == 'lime' %}border-lime-500{% elif widget.color == 'green' %}border-green-500{% elif widget.color == 'teal' %}border-teal-500{% elif widget.color == 'cyan' %}border-cyan-500{% elif widget.color == 'sky' %}border-sky-500{% elif widget.color == 'slate' %}border-slate-500{% elif widget.color == 'gray' %}border-gray-500{% else %}border-blue-500{% endif %}
            {% endif %}
            {% comment %}Default solid style if no bg_style{% endcomment %}
            {% if not widget.bg_style %}bg-white dark:bg-gray-800 shadow-md hover:shadow-lg{% endif %}">

    {% if widget.show_header != False %}
    <!-- Widget Header -->
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 flex items-center justify-center
                {% if widget.border_radius == 'square' %}rounded-none{% elif widget.border_radius == 'pill' %}rounded-full{% else %}rounded-lg{% endif %}
                {% if widget.color == 'blue' %}bg-blue-100 dark:bg-blue-900/30{% elif widget.color == 'indigo' %}bg-indigo-100 dark:bg-indigo-900/30{% elif widget.color == 'purple' %}bg-purple-100 dark:bg-purple-900/30{% elif widget.color == 'pink' %}bg-pink-100 dark:bg-pink-900/30{% elif widget.color == 'red' %}bg-red-100 dark:bg-red-900/30{% elif widget.color == 'orange' %}bg-orange-100 dark:bg-orange-900/30{% elif widget.color == 'amber' %}bg-amber-100 dark:bg-amber-900/30{% elif widget.color == 'yellow' %}bg-yellow-100 dark:bg-yellow-900/30{% elif widget.color == 'lime' %}bg-lime-100 dark:bg-lime-900/30{% elif widget.color == 'green' %}bg-green-100 dark:bg-green-900/30{% elif widget.color == 'teal' %}bg-teal-100 dark:bg-teal-900/30{% elif widget.color == 'cyan' %}bg-cyan-100 dark:bg-cyan-900/30{% elif widget.color == 'sky' %}bg-sky-100 dark:bg-sky-900/30{% elif widget.color == 'slate' %}bg-slate-100 dark:bg-slate-900/30{% elif widget.color == 'gray' %}bg-gray-100 dark:bg-gray-700{% else %}bg-blue-100 dark:bg-blue-900/30{% endif %}">
                <i data-lucide="{{ widget.icon }}" class="w-5 h-5
                    {% if widget.color == 'blue' %}text-blue-600 dark:text-blue-400{% elif widget.color == 'indigo' %}text-indigo-600 dark:text-indigo-400{% elif widget.color == 'purple' %}text-purple-600 dark:text-purple-400{% elif widget.color == 'pink' %}text-pink-600 dark:text-pink-400{% elif widget.color == 'red' %}text-red-600 dark:text-red-400{% elif widget.color == 'orange' %}text-orange-600 dark:text-orange-400{% elif widget.color == 'amber' %}text-amber-600 dark:text-amber-400{% elif widget.color == 'yellow' %}text-yellow-600 dark:text-yellow-400{% elif widget.color == 'lime' %}text-lime-600 dark:text-lime-400{% elif widget.color == 'green' %}text-green-600 dark:text-green-400{% elif widget.color == 'teal' %}text-teal-600 dark:text-teal-400{% elif widget.color == 'cyan' %}text-cyan-600 dark:text-cyan-400{% elif widget.color == 'sky' %}text-sky-600 dark:text-sky-400{% elif widget.color == 'slate' %}text-slate-600 dark:text-slate-400{% elif widget.color == 'gray' %}text-gray-600 dark:text-gray-400{% else %}text-blue-600 dark:text-blue-400{% endif %}"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white
                {% if widget.text_size == 'small' %}text-sm{% elif widget.text_size == 'large' %}text-xl{% else %}text-base{% endif %}">{{ widget.name }}</h3>
        </div>
    </div>
    {% endif %}

    <!-- Widget Content -->
    <div class="widget-content {% if widget.text_size == 'small' %}text-sm{% elif widget.text_size == 'large' %}text-lg{% endif %}">
        {% if widget.id == 'work_orders_summary' %}
            <!-- Work Orders Summary Widget -->
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ widget.data.total|default:0|intcomma }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Total</p>
                </div>
                <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                    <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ widget.data.active|default:0|intcomma }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Active</p>
                </div>
                <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <p class="text-2xl font-bold text-green-600 dark:text-green-400">{{ widget.data.completed_week|default:0|intcomma }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Completed (Week)</p>
                </div>
                <div class="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <p class="text-2xl font-bold text-red-600 dark:text-red-400">{{ widget.data.overdue|default:0|intcomma }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Overdue</p>
                </div>
            </div>

        {% elif widget.id == 'drill_bits_status' %}
            <!-- Drill Bits Status Widget -->
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <span class="text-gray-600 dark:text-gray-400">Total</span>
                    <span class="text-lg font-semibold text-gray-900 dark:text-white">{{ widget.data.total|default:0|intcomma }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-gray-600 dark:text-gray-400">In Stock</span>
                    <span class="text-lg font-semibold text-green-600 dark:text-green-400">{{ widget.data.in_stock|default:0|intcomma }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-gray-600 dark:text-gray-400">In Production</span>
                    <span class="text-lg font-semibold text-blue-600 dark:text-blue-400">{{ widget.data.in_production|default:0|intcomma }}</span>
                </div>
            </div>

        {% elif widget.id == 'recent_work_orders' %}
            <!-- Recent Work Orders Widget -->
            {% if widget.data.work_orders %}
            <div class="space-y-3">
                {% for wo in widget.data.work_orders %}
                <a href="{% url 'workorders:detail' wo.pk %}" class="flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 rounded-full
                            {% if wo.status == 'COMPLETED' %}bg-green-500
                            {% elif wo.status == 'IN_PROGRESS' %}bg-blue-500
                            {% elif wo.status == 'OVERDUE' %}bg-red-500
                            {% else %}bg-gray-400{% endif %}"></div>
                        <div>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">{{ wo.wo_number }}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ wo.customer.name|default:"No customer" }}</p>
                        </div>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full
                        {% if wo.status == 'COMPLETED' %}bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400
                        {% elif wo.status == 'IN_PROGRESS' %}bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400
                        {% else %}bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                        {{ wo.get_status_display }}
                    </span>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">No recent work orders</p>
            {% endif %}

        {% elif widget.id == 'maintenance_due' %}
            <!-- Maintenance Due Widget -->
            <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <span class="text-gray-600 dark:text-gray-400">Overdue</span>
                    <span class="text-xl font-bold text-red-600 dark:text-red-400">{{ widget.data.overdue|default:0|intcomma }}</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                    <span class="text-gray-600 dark:text-gray-400">Due Soon (7 days)</span>
                    <span class="text-xl font-bold text-yellow-600 dark:text-yellow-400">{{ widget.data.due_soon|default:0|intcomma }}</span>
                </div>
            </div>

        {% elif widget.id == 'open_ncrs' %}
            <!-- Open NCRs Widget -->
            <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                    <span class="text-gray-600 dark:text-gray-400">Open NCRs</span>
                    <span class="text-xl font-bold text-orange-600 dark:text-orange-400">{{ widget.data.open|default:0|intcomma }}</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <span class="text-gray-600 dark:text-gray-400">Critical</span>
                    <span class="text-xl font-bold text-red-600 dark:text-red-400">{{ widget.data.critical|default:0|intcomma }}</span>
                </div>
            </div>

        {% elif widget.id == 'low_stock_alerts' %}
            <!-- Low Stock Alerts Widget -->
            <div class="text-center p-4">
                <div class="w-16 h-16 mx-auto mb-3 rounded-full
                    {% if widget.data.count > 0 %}bg-yellow-100 dark:bg-yellow-900/30{% else %}bg-green-100 dark:bg-green-900/30{% endif %}
                    flex items-center justify-center">
                    <i data-lucide="package" class="w-8 h-8
                        {% if widget.data.count > 0 %}text-yellow-600 dark:text-yellow-400{% else %}text-green-600 dark:text-green-400{% endif %}"></i>
                </div>
                <p class="text-3xl font-bold
                    {% if widget.data.count > 0 %}text-yellow-600 dark:text-yellow-400{% else %}text-green-600 dark:text-green-400{% endif %}">
                    {{ widget.data.count|default:0|intcomma }}
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Items below reorder point</p>
            </div>

        {% elif widget.id == 'pending_approvals' %}
            <!-- Pending Approvals Widget -->
            <div class="text-center p-4">
                <p class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ widget.data.pr_count|default:0|intcomma }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Purchase Requisitions</p>
            </div>

        {% elif widget.id == 'quick_links' %}
            <!-- Quick Links Widget -->
            <div class="grid grid-cols-2 gap-2">
                {% for link in widget.data.links %}
                <a href="{% url link.url %}" class="flex items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i data-lucide="{{ link.icon }}" class="w-5 h-5 text-gray-500 dark:text-gray-400 mr-2"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ link.name }}</span>
                </a>
                {% endfor %}
            </div>

        {% else %}
            <!-- Generic KPI Widget -->
            {% if widget.data.count is not None %}
            <div class="text-center">
                <p class="{% if widget.text_size == 'small' %}text-3xl{% elif widget.text_size == 'large' %}text-5xl{% else %}text-4xl{% endif %} font-bold text-gray-900 dark:text-white">{{ widget.data.count|default:0|intcomma }}</p>
                {% if widget.data.label %}
                <p class="{% if widget.text_size == 'small' %}text-xs{% elif widget.text_size == 'large' %}text-base{% else %}text-sm{% endif %} text-gray-500 dark:text-gray-400 mt-1">{{ widget.data.label }}</p>
                {% endif %}
            </div>
            {% else %}
            <!-- Unknown Widget -->
            <div class="text-center py-4">
                <i data-lucide="help-circle" class="w-8 h-8 mx-auto mb-2 text-gray-300 dark:text-gray-600"></i>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ widget.description|default:"Widget data not available" }}</p>
            </div>
            {% endif %}
        {% endif %}
    </div>
</div>

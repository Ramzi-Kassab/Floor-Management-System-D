# Generated by Django 5.2.8 on 2025-12-06 02:47

import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("inventory", "0005_materialconsumption_operation_execution_and_more"),
        ("quality", "0003_alter_inspection_procedure_and_more"),
        ("sales", "0006_week3_field_data_capture"),
        ("supplychain", "0001_initial"),
        (
            "workorders",
            "0003_alter_bitevaluation_rig_alter_bitevaluation_well_and_more",
        ),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name="PaymentTerm",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "term_code",
                    models.CharField(
                        help_text="Payment term code (e.g., NET30)",
                        max_length=20,
                        unique=True,
                    ),
                ),
                (
                    "term_name",
                    models.CharField(help_text="Payment term name", max_length=100),
                ),
                ("description", models.TextField(blank=True, help_text="Description")),
                (
                    "due_days",
                    models.IntegerField(help_text="Days until payment is due"),
                ),
                (
                    "discount_days",
                    models.IntegerField(
                        blank=True,
                        help_text="Days to qualify for early payment discount",
                        null=True,
                    ),
                ),
                (
                    "discount_percent",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Early payment discount percentage",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(default=True, help_text="Is term active?"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Payment Term",
                "verbose_name_plural": "Payment Terms",
                "db_table": "payment_terms",
                "ordering": ["due_days", "term_code"],
            },
        ),
        migrations.CreateModel(
            name="CAPA",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("capa_number", models.CharField(max_length=30, unique=True)),
                ("title", models.CharField(max_length=200)),
                ("description", models.TextField()),
                ("root_cause", models.TextField(blank=True)),
                ("corrective_action", models.TextField(blank=True)),
                ("preventive_action", models.TextField(blank=True)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("OPEN", "Open"),
                            ("IN_PROGRESS", "In Progress"),
                            ("VERIFICATION", "Pending Verification"),
                            ("CLOSED", "Closed"),
                        ],
                        default="OPEN",
                        max_length=20,
                    ),
                ),
                ("due_date", models.DateField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "assigned_to",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="assigned_capas",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "ncr",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="capas",
                        to="quality.ncr",
                    ),
                ),
            ],
            options={
                "verbose_name": "CAPA",
                "verbose_name_plural": "CAPAs",
                "db_table": "capas",
            },
        ),
        migrations.CreateModel(
            name="ExpenseCategory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "category_code",
                    models.CharField(
                        help_text="Unique category code", max_length=20, unique=True
                    ),
                ),
                (
                    "category_name",
                    models.CharField(help_text="Category name", max_length=100),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="Category description"),
                ),
                (
                    "gl_account_code",
                    models.CharField(
                        blank=True, help_text="GL account for posting", max_length=50
                    ),
                ),
                (
                    "is_billable",
                    models.BooleanField(
                        default=False, help_text="Can be billed to customer?"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(default=True, help_text="Is category active?"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "parent_category",
                    models.ForeignKey(
                        blank=True,
                        help_text="Parent category for hierarchy",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="subcategories",
                        to="supplychain.expensecategory",
                    ),
                ),
            ],
            options={
                "verbose_name": "Expense Category",
                "verbose_name_plural": "Expense Categories",
                "db_table": "expense_categories",
                "ordering": ["category_code"],
            },
        ),
        migrations.CreateModel(
            name="PurchaseOrder",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "po_number",
                    models.CharField(
                        db_index=True,
                        help_text="Unique PO number (auto-generated: PO-YYYY-######)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "order_type",
                    models.CharField(
                        choices=[
                            ("STANDARD", "Standard Purchase Order"),
                            ("BLANKET", "Blanket PO (Framework Agreement)"),
                            ("CONTRACT", "Contract PO"),
                            ("SERVICE", "Service Order"),
                            ("RENTAL", "Equipment Rental"),
                        ],
                        default="STANDARD",
                        help_text="Type of purchase order",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("DRAFT", "Draft"),
                            ("PENDING_APPROVAL", "Pending Approval"),
                            ("APPROVED", "Approved"),
                            ("SENT", "Sent to Vendor"),
                            ("ACKNOWLEDGED", "Acknowledged by Vendor"),
                            ("IN_PROGRESS", "In Progress"),
                            ("PARTIALLY_RECEIVED", "Partially Received"),
                            ("COMPLETED", "Completed"),
                            ("CANCELLED", "Cancelled"),
                            ("CLOSED", "Closed"),
                        ],
                        db_index=True,
                        default="DRAFT",
                        help_text="Current PO status",
                        max_length=25,
                    ),
                ),
                ("order_date", models.DateField(help_text="Date PO was created")),
                (
                    "required_date",
                    models.DateField(
                        blank=True, help_text="Date items are needed", null=True
                    ),
                ),
                (
                    "expected_delivery_date",
                    models.DateField(
                        blank=True,
                        help_text="Expected delivery date from vendor",
                        null=True,
                    ),
                ),
                (
                    "ship_to_address",
                    models.TextField(
                        blank=True, help_text="Delivery address if not to a site"
                    ),
                ),
                (
                    "shipping_instructions",
                    models.TextField(
                        blank=True, help_text="Special shipping instructions"
                    ),
                ),
                (
                    "currency_code",
                    models.CharField(default="USD", help_text="Currency", max_length=3),
                ),
                (
                    "subtotal_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Subtotal before tax",
                        max_digits=15,
                    ),
                ),
                (
                    "tax_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Tax amount",
                        max_digits=15,
                    ),
                ),
                (
                    "shipping_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Shipping/freight amount",
                        max_digits=15,
                    ),
                ),
                (
                    "discount_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Discount amount",
                        max_digits=15,
                    ),
                ),
                (
                    "total_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Total PO amount",
                        max_digits=15,
                    ),
                ),
                (
                    "submitted_for_approval_at",
                    models.DateTimeField(
                        blank=True, help_text="When submitted for approval", null=True
                    ),
                ),
                (
                    "approved_at",
                    models.DateTimeField(
                        blank=True, help_text="When approved", null=True
                    ),
                ),
                (
                    "sent_to_vendor_at",
                    models.DateTimeField(
                        blank=True, help_text="When sent to vendor", null=True
                    ),
                ),
                (
                    "acknowledged_by_vendor",
                    models.BooleanField(
                        default=False, help_text="Has vendor acknowledged?"
                    ),
                ),
                (
                    "acknowledged_at",
                    models.DateTimeField(
                        blank=True, help_text="When vendor acknowledged", null=True
                    ),
                ),
                (
                    "vendor_reference_number",
                    models.CharField(
                        blank=True,
                        help_text="Vendor's reference/confirmation number",
                        max_length=100,
                    ),
                ),
                (
                    "terms_and_conditions",
                    models.TextField(blank=True, help_text="Terms and conditions"),
                ),
                (
                    "special_instructions",
                    models.TextField(
                        blank=True, help_text="Special instructions for vendor"
                    ),
                ),
                (
                    "internal_notes",
                    models.TextField(
                        blank=True, help_text="Internal notes (not sent to vendor)"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who approved",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="approved_purchase_orders",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        help_text="User who created PO",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_pos",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "payment_term",
                    models.ForeignKey(
                        blank=True,
                        help_text="Payment terms",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="purchase_orders",
                        to="supplychain.paymentterm",
                    ),
                ),
                (
                    "ship_to_site",
                    models.ForeignKey(
                        blank=True,
                        help_text="Delivery location",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="purchase_orders",
                        to="sales.servicesite",
                    ),
                ),
                (
                    "work_order",
                    models.ForeignKey(
                        blank=True,
                        help_text="Related work order",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="po_orders",
                        to="workorders.workorder",
                    ),
                ),
            ],
            options={
                "verbose_name": "Purchase Order",
                "verbose_name_plural": "Purchase Orders",
                "db_table": "purchase_orders_v2",
                "ordering": ["-order_date", "-po_number"],
                "permissions": [
                    ("can_approve_purchase_orders", "Can approve purchase orders"),
                    ("can_send_purchase_orders", "Can send POs to vendors"),
                ],
            },
        ),
        migrations.CreateModel(
            name="PurchaseOrderLine",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("line_number", models.IntegerField(help_text="Line sequence number")),
                (
                    "item_description",
                    models.CharField(help_text="Item description", max_length=500),
                ),
                (
                    "part_number",
                    models.CharField(
                        blank=True, help_text="Internal part number", max_length=100
                    ),
                ),
                (
                    "manufacturer_part_number",
                    models.CharField(
                        blank=True,
                        help_text="Manufacturer's part number",
                        max_length=100,
                    ),
                ),
                (
                    "quantity_ordered",
                    models.DecimalField(
                        decimal_places=3, help_text="Quantity ordered", max_digits=10
                    ),
                ),
                (
                    "quantity_received",
                    models.DecimalField(
                        decimal_places=3,
                        default=Decimal("0.000"),
                        help_text="Quantity received so far",
                        max_digits=10,
                    ),
                ),
                (
                    "quantity_invoiced",
                    models.DecimalField(
                        decimal_places=3,
                        default=Decimal("0.000"),
                        help_text="Quantity invoiced so far",
                        max_digits=10,
                    ),
                ),
                (
                    "unit_of_measure",
                    models.CharField(help_text="Unit of measure", max_length=20),
                ),
                (
                    "unit_price",
                    models.DecimalField(
                        decimal_places=4, help_text="Unit price", max_digits=12
                    ),
                ),
                (
                    "discount_percent",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Line discount percentage",
                        max_digits=5,
                    ),
                ),
                (
                    "tax_percent",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Tax percentage",
                        max_digits=5,
                    ),
                ),
                (
                    "line_total",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Line total (calculated)",
                        max_digits=15,
                    ),
                ),
                ("required_date", models.DateField(help_text="Line required date")),
                (
                    "promised_date",
                    models.DateField(
                        blank=True, help_text="Vendor promised date", null=True
                    ),
                ),
                (
                    "is_cancelled",
                    models.BooleanField(default=False, help_text="Is line cancelled?"),
                ),
                (
                    "is_closed",
                    models.BooleanField(
                        default=False,
                        help_text="Is line closed (manually or fully received)?",
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="Line notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "inventory_item",
                    models.ForeignKey(
                        blank=True,
                        help_text="Link to inventory item",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="purchase_order_lines",
                        to="inventory.inventoryitem",
                    ),
                ),
                (
                    "purchase_order",
                    models.ForeignKey(
                        help_text="Parent purchase order",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="lines",
                        to="supplychain.purchaseorder",
                    ),
                ),
            ],
            options={
                "db_table": "purchase_order_lines_v2",
                "ordering": ["purchase_order", "line_number"],
                "unique_together": {("purchase_order", "line_number")},
            },
        ),
        migrations.CreateModel(
            name="PurchaseRequisition",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "requisition_number",
                    models.CharField(
                        db_index=True,
                        help_text="Unique requisition number (auto-generated: REQ-YYYY-####)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "department",
                    models.CharField(help_text="Requesting department", max_length=100),
                ),
                (
                    "title",
                    models.CharField(
                        help_text="Brief title for the requisition", max_length=200
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description of what is needed"
                    ),
                ),
                (
                    "justification",
                    models.TextField(
                        blank=True, help_text="Business justification for the purchase"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("DRAFT", "Draft"),
                            ("SUBMITTED", "Submitted for Approval"),
                            ("APPROVED", "Approved"),
                            ("REJECTED", "Rejected"),
                            ("CONVERTED_TO_PO", "Converted to PO"),
                            ("CANCELLED", "Cancelled"),
                        ],
                        db_index=True,
                        default="DRAFT",
                        help_text="Current requisition status",
                        max_length=20,
                    ),
                ),
                (
                    "priority",
                    models.CharField(
                        choices=[
                            ("LOW", "Low"),
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("URGENT", "Urgent"),
                        ],
                        default="MEDIUM",
                        help_text="Request priority",
                        max_length=10,
                    ),
                ),
                (
                    "request_date",
                    models.DateField(help_text="Date requisition was created"),
                ),
                (
                    "required_date",
                    models.DateField(help_text="Date items are needed by"),
                ),
                (
                    "submitted_at",
                    models.DateTimeField(
                        blank=True, help_text="When submitted for approval", null=True
                    ),
                ),
                (
                    "approved_at",
                    models.DateTimeField(
                        blank=True, help_text="When approved", null=True
                    ),
                ),
                (
                    "approval_notes",
                    models.TextField(blank=True, help_text="Approval notes"),
                ),
                (
                    "rejected_at",
                    models.DateTimeField(
                        blank=True, help_text="When rejected", null=True
                    ),
                ),
                (
                    "rejection_reason",
                    models.TextField(blank=True, help_text="Reason for rejection"),
                ),
                (
                    "converted_at",
                    models.DateTimeField(
                        blank=True, help_text="When converted to PO", null=True
                    ),
                ),
                (
                    "estimated_total_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Estimated total cost",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "budget_code",
                    models.CharField(
                        blank=True,
                        help_text="Budget code for allocation",
                        max_length=50,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who approved",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="requisitions_approved",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "converted_to_po",
                    models.ForeignKey(
                        blank=True,
                        help_text="PO created from this requisition",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="source_requisitions",
                        to="supplychain.purchaseorder",
                    ),
                ),
                (
                    "rejected_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who rejected",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="requisitions_rejected",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "requested_by",
                    models.ForeignKey(
                        help_text="User who requested the purchase",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="requisitions_requested",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "work_order",
                    models.ForeignKey(
                        blank=True,
                        help_text="Work order this requisition supports",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="purchase_requisitions",
                        to="workorders.workorder",
                    ),
                ),
            ],
            options={
                "verbose_name": "Purchase Requisition",
                "verbose_name_plural": "Purchase Requisitions",
                "db_table": "purchase_requisitions",
                "ordering": ["-request_date", "-requisition_number"],
            },
        ),
        migrations.AddField(
            model_name="purchaseorder",
            name="requisition",
            field=models.ForeignKey(
                blank=True,
                help_text="Source requisition",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="purchase_orders",
                to="supplychain.purchaserequisition",
            ),
        ),
        migrations.CreateModel(
            name="PurchaseRequisitionLine",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("line_number", models.IntegerField(help_text="Line sequence number")),
                (
                    "item_description",
                    models.CharField(
                        help_text="Description of item/service", max_length=500
                    ),
                ),
                (
                    "part_number",
                    models.CharField(
                        blank=True, help_text="Part number if known", max_length=100
                    ),
                ),
                (
                    "quantity_requested",
                    models.DecimalField(
                        decimal_places=3, help_text="Quantity requested", max_digits=10
                    ),
                ),
                (
                    "unit_of_measure",
                    models.CharField(help_text="Unit of measure", max_length=20),
                ),
                (
                    "estimated_unit_price",
                    models.DecimalField(
                        blank=True,
                        decimal_places=4,
                        help_text="Estimated unit price",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "estimated_line_total",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Estimated line total",
                        max_digits=15,
                        null=True,
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="Line notes")),
                (
                    "inventory_item",
                    models.ForeignKey(
                        blank=True,
                        help_text="Link to inventory item",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="requisition_lines",
                        to="inventory.inventoryitem",
                    ),
                ),
                (
                    "requisition",
                    models.ForeignKey(
                        help_text="Parent requisition",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="lines",
                        to="supplychain.purchaserequisition",
                    ),
                ),
            ],
            options={
                "db_table": "purchase_requisition_lines",
                "ordering": ["requisition", "line_number"],
            },
        ),
        migrations.CreateModel(
            name="Receipt",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "receipt_number",
                    models.CharField(
                        db_index=True,
                        help_text="Unique receipt number (auto-generated: RCP-YYYY-######)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "receipt_type",
                    models.CharField(
                        choices=[
                            ("GOODS", "Goods Receipt"),
                            ("SERVICES", "Services Receipt"),
                            ("RETURN", "Return from Customer"),
                        ],
                        default="GOODS",
                        help_text="Type of receipt",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("DRAFT", "Draft"),
                            ("INSPECTING", "Under Inspection"),
                            ("ACCEPTED", "Accepted"),
                            ("PARTIALLY_ACCEPTED", "Partially Accepted"),
                            ("REJECTED", "Rejected"),
                            ("COMPLETED", "Completed"),
                        ],
                        db_index=True,
                        default="DRAFT",
                        help_text="Receipt status",
                        max_length=25,
                    ),
                ),
                ("receipt_date", models.DateField(help_text="Date of receipt")),
                (
                    "expected_receipt_date",
                    models.DateField(
                        blank=True, help_text="Expected delivery date", null=True
                    ),
                ),
                (
                    "packing_slip_number",
                    models.CharField(
                        blank=True,
                        help_text="Vendor's packing slip number",
                        max_length=100,
                    ),
                ),
                (
                    "carrier",
                    models.CharField(
                        blank=True, help_text="Shipping carrier", max_length=100
                    ),
                ),
                (
                    "tracking_number",
                    models.CharField(
                        blank=True, help_text="Tracking number", max_length=100
                    ),
                ),
                (
                    "inspection_date",
                    models.DateField(
                        blank=True, help_text="Date of inspection", null=True
                    ),
                ),
                (
                    "inspection_notes",
                    models.TextField(blank=True, help_text="Inspection notes"),
                ),
                (
                    "quality_acceptable",
                    models.BooleanField(
                        blank=True, help_text="Overall quality acceptable?", null=True
                    ),
                ),
                (
                    "rejection_reason",
                    models.TextField(
                        blank=True, help_text="Reason for rejection if applicable"
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="General notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "inspected_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who performed inspection",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="receipts_inspected",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "purchase_order",
                    models.ForeignKey(
                        help_text="Related purchase order",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="receipts",
                        to="supplychain.purchaseorder",
                    ),
                ),
                (
                    "received_by",
                    models.ForeignKey(
                        help_text="User who received goods",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="goods_received",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Receipt",
                "verbose_name_plural": "Receipts",
                "db_table": "receipts",
                "ordering": ["-receipt_date", "-receipt_number"],
            },
        ),
        migrations.CreateModel(
            name="ReceiptLine",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("line_number", models.IntegerField(help_text="Line sequence number")),
                (
                    "quantity_received",
                    models.DecimalField(
                        decimal_places=3, help_text="Quantity received", max_digits=10
                    ),
                ),
                (
                    "quantity_accepted",
                    models.DecimalField(
                        decimal_places=3,
                        default=Decimal("0.000"),
                        help_text="Quantity accepted after inspection",
                        max_digits=10,
                    ),
                ),
                (
                    "quantity_rejected",
                    models.DecimalField(
                        decimal_places=3,
                        default=Decimal("0.000"),
                        help_text="Quantity rejected",
                        max_digits=10,
                    ),
                ),
                (
                    "inspection_status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Inspection"),
                            ("PASSED", "Passed"),
                            ("FAILED", "Failed"),
                            ("PARTIAL", "Partially Passed"),
                        ],
                        default="PENDING",
                        help_text="Inspection status",
                        max_length=20,
                    ),
                ),
                (
                    "defect_description",
                    models.TextField(
                        blank=True, help_text="Description of any defects"
                    ),
                ),
                (
                    "storage_location_code",
                    models.CharField(
                        blank=True,
                        help_text="Storage location code where items were stored",
                        max_length=50,
                    ),
                ),
                (
                    "lot_number",
                    models.CharField(
                        blank=True, help_text="Lot/batch number", max_length=100
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="Line notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "po_line",
                    models.ForeignKey(
                        help_text="Related PO line",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="receipt_lines",
                        to="supplychain.purchaseorderline",
                    ),
                ),
                (
                    "receipt",
                    models.ForeignKey(
                        help_text="Parent receipt",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="lines",
                        to="supplychain.receipt",
                    ),
                ),
            ],
            options={
                "db_table": "receipt_lines",
                "ordering": ["receipt", "line_number"],
            },
        ),
        migrations.CreateModel(
            name="Vendor",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "vendor_code",
                    models.CharField(
                        db_index=True,
                        help_text="Unique vendor code (auto-generated: VEND-####)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        db_index=True,
                        help_text="Legal vendor/company name",
                        max_length=200,
                    ),
                ),
                (
                    "name_ar",
                    models.CharField(
                        blank=True, help_text="Vendor name in Arabic", max_length=200
                    ),
                ),
                (
                    "dba_name",
                    models.CharField(
                        blank=True,
                        help_text="Doing Business As (DBA) name if different",
                        max_length=200,
                    ),
                ),
                (
                    "vendor_type",
                    models.CharField(
                        choices=[
                            ("MATERIALS_SUPPLIER", "Materials Supplier"),
                            ("PARTS_SUPPLIER", "Parts Supplier"),
                            ("SERVICE_PROVIDER", "Service Provider"),
                            ("CONTRACTOR", "Contractor"),
                            ("MANUFACTURER", "Manufacturer"),
                            ("DISTRIBUTOR", "Distributor"),
                            ("CONSULTANT", "Consultant"),
                            ("OTHER", "Other"),
                        ],
                        default="MATERIALS_SUPPLIER",
                        help_text="Primary vendor type/category",
                        max_length=30,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PROSPECT", "Prospect - Under evaluation"),
                            ("QUALIFIED", "Qualified - Approved for business"),
                            ("ACTIVE", "Active - Currently doing business"),
                            ("INACTIVE", "Inactive - Not currently active"),
                            ("SUSPENDED", "Suspended - Temporarily blocked"),
                            ("DISQUALIFIED", "Disqualified - Not approved"),
                        ],
                        db_index=True,
                        default="PROSPECT",
                        help_text="Current vendor status",
                        max_length=20,
                    ),
                ),
                (
                    "qualification_level",
                    models.CharField(
                        choices=[
                            ("NOT_QUALIFIED", "Not Qualified"),
                            ("BASIC", "Basic - Standard products only"),
                            ("STANDARD", "Standard - Most products"),
                            ("PREFERRED", "Preferred - All products"),
                            ("STRATEGIC", "Strategic Partner"),
                        ],
                        default="NOT_QUALIFIED",
                        help_text="Quality qualification level",
                        max_length=20,
                    ),
                ),
                (
                    "tax_id",
                    models.CharField(
                        blank=True, help_text="Tax ID / VAT number", max_length=50
                    ),
                ),
                (
                    "registration_number",
                    models.CharField(
                        blank=True,
                        help_text="Business registration number",
                        max_length=100,
                    ),
                ),
                ("website", models.URLField(blank=True, help_text="Company website")),
                (
                    "year_established",
                    models.IntegerField(
                        blank=True, help_text="Year company was established", null=True
                    ),
                ),
                (
                    "employee_count",
                    models.IntegerField(
                        blank=True,
                        help_text="Approximate number of employees",
                        null=True,
                    ),
                ),
                (
                    "address_line_1",
                    models.CharField(help_text="Street address line 1", max_length=500),
                ),
                (
                    "address_line_2",
                    models.CharField(
                        blank=True, help_text="Street address line 2", max_length=500
                    ),
                ),
                ("city", models.CharField(help_text="City", max_length=100)),
                (
                    "state_province",
                    models.CharField(
                        blank=True, help_text="State or province", max_length=100
                    ),
                ),
                (
                    "postal_code",
                    models.CharField(
                        blank=True, help_text="Postal/ZIP code", max_length=20
                    ),
                ),
                (
                    "country",
                    models.CharField(
                        default="Saudi Arabia", help_text="Country", max_length=100
                    ),
                ),
                (
                    "phone",
                    models.CharField(help_text="Main phone number", max_length=50),
                ),
                (
                    "fax",
                    models.CharField(blank=True, help_text="Fax number", max_length=50),
                ),
                (
                    "email",
                    models.EmailField(help_text="Main email address", max_length=254),
                ),
                (
                    "accounts_payable_email",
                    models.EmailField(
                        blank=True,
                        help_text="AP/invoicing email address",
                        max_length=254,
                    ),
                ),
                (
                    "currency_code",
                    models.CharField(
                        default="USD",
                        help_text="Default currency (ISO 4217 code)",
                        max_length=3,
                    ),
                ),
                (
                    "credit_limit",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Credit limit amount",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "on_time_delivery_rate",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="On-time delivery percentage",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "quality_rating",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Quality rating (1-5 scale)",
                        max_digits=3,
                        null=True,
                    ),
                ),
                (
                    "total_purchase_orders",
                    models.IntegerField(
                        default=0, help_text="Total number of POs issued"
                    ),
                ),
                (
                    "total_purchase_value",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Total value of all purchases",
                        max_digits=15,
                    ),
                ),
                (
                    "last_purchase_date",
                    models.DateField(
                        blank=True, help_text="Date of last purchase order", null=True
                    ),
                ),
                (
                    "product_categories",
                    models.TextField(
                        blank=True, help_text="Products/services this vendor can supply"
                    ),
                ),
                (
                    "certifications",
                    models.TextField(
                        blank=True, help_text="Quality certifications (ISO, API, etc.)"
                    ),
                ),
                (
                    "capabilities",
                    models.TextField(
                        blank=True, help_text="Special capabilities or expertise"
                    ),
                ),
                (
                    "minimum_order_value",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Minimum order value required",
                        max_digits=10,
                        null=True,
                    ),
                ),
                (
                    "lead_time_days",
                    models.IntegerField(
                        blank=True, help_text="Typical lead time in days", null=True
                    ),
                ),
                (
                    "qualification_date",
                    models.DateField(
                        blank=True, help_text="Date vendor was qualified", null=True
                    ),
                ),
                (
                    "qualification_expiry_date",
                    models.DateField(
                        blank=True, help_text="Date qualification expires", null=True
                    ),
                ),
                (
                    "qualification_notes",
                    models.TextField(
                        blank=True,
                        help_text="Notes on qualification process and criteria",
                    ),
                ),
                (
                    "active_since",
                    models.DateField(
                        blank=True, help_text="Date vendor became active", null=True
                    ),
                ),
                (
                    "inactive_since",
                    models.DateField(
                        blank=True, help_text="Date vendor became inactive", null=True
                    ),
                ),
                (
                    "suspension_reason",
                    models.TextField(
                        blank=True, help_text="Reason for suspension if applicable"
                    ),
                ),
                (
                    "insurance_certificate_number",
                    models.CharField(
                        blank=True,
                        help_text="Insurance certificate number",
                        max_length=100,
                    ),
                ),
                (
                    "insurance_expiry_date",
                    models.DateField(
                        blank=True, help_text="Insurance expiry date", null=True
                    ),
                ),
                (
                    "liability_coverage_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Liability insurance coverage amount",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "compliance_documents_verified",
                    models.BooleanField(
                        default=False,
                        help_text="Whether compliance documents have been verified",
                    ),
                ),
                (
                    "bank_name",
                    models.CharField(
                        blank=True, help_text="Bank name for payments", max_length=200
                    ),
                ),
                (
                    "bank_account_number",
                    models.CharField(
                        blank=True, help_text="Bank account number", max_length=100
                    ),
                ),
                (
                    "bank_routing_number",
                    models.CharField(
                        blank=True, help_text="Bank routing/SWIFT code", max_length=50
                    ),
                ),
                (
                    "iban",
                    models.CharField(
                        blank=True,
                        help_text="IBAN for international transfers",
                        max_length=50,
                    ),
                ),
                (
                    "internal_notes",
                    models.TextField(
                        blank=True, help_text="Internal notes (not visible to vendor)"
                    ),
                ),
                (
                    "purchasing_notes",
                    models.TextField(blank=True, help_text="Notes for purchasing team"),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When vendor was added to system"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="When vendor was last updated"
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        help_text="User who created vendor record",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_vendors",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "default_payment_term",
                    models.ForeignKey(
                        blank=True,
                        help_text="Default payment terms for this vendor",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="vendors",
                        to="supplychain.paymentterm",
                    ),
                ),
                (
                    "qualified_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who qualified this vendor",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="qualified_vendors",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Vendor",
                "verbose_name_plural": "Vendors",
                "db_table": "vendors",
                "ordering": ["name"],
                "permissions": [
                    ("can_qualify_vendors", "Can qualify and approve vendors"),
                    ("can_suspend_vendors", "Can suspend vendors"),
                    ("can_view_vendor_financials", "Can view vendor financial data"),
                ],
            },
        ),
        migrations.AddField(
            model_name="receipt",
            name="vendor",
            field=models.ForeignKey(
                help_text="Vendor who delivered",
                on_delete=django.db.models.deletion.PROTECT,
                related_name="receipts",
                to="supplychain.vendor",
            ),
        ),
        migrations.AddField(
            model_name="purchaseorder",
            name="vendor",
            field=models.ForeignKey(
                help_text="Vendor to purchase from",
                on_delete=django.db.models.deletion.PROTECT,
                related_name="purchase_orders",
                to="supplychain.vendor",
            ),
        ),
        migrations.CreateModel(
            name="VendorContact",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "first_name",
                    models.CharField(help_text="Contact first name", max_length=100),
                ),
                (
                    "last_name",
                    models.CharField(help_text="Contact last name", max_length=100),
                ),
                (
                    "title",
                    models.CharField(blank=True, help_text="Job title", max_length=100),
                ),
                (
                    "contact_type",
                    models.CharField(
                        choices=[
                            ("SALES", "Sales Representative"),
                            ("PURCHASING", "Purchasing/Buyer"),
                            ("TECHNICAL", "Technical Support"),
                            ("ACCOUNT_MANAGER", "Account Manager"),
                            ("BILLING", "Billing/Accounts Receivable"),
                            ("QUALITY", "Quality Manager"),
                            ("LOGISTICS", "Logistics/Shipping"),
                            ("EXECUTIVE", "Executive"),
                            ("OTHER", "Other"),
                        ],
                        default="SALES",
                        help_text="Type of contact",
                        max_length=20,
                    ),
                ),
                (
                    "department",
                    models.CharField(
                        blank=True, help_text="Department", max_length=100
                    ),
                ),
                ("email", models.EmailField(help_text="Email address", max_length=254)),
                ("phone", models.CharField(help_text="Phone number", max_length=50)),
                (
                    "mobile",
                    models.CharField(
                        blank=True, help_text="Mobile number", max_length=50
                    ),
                ),
                (
                    "fax",
                    models.CharField(blank=True, help_text="Fax number", max_length=50),
                ),
                (
                    "is_primary",
                    models.BooleanField(
                        default=False, help_text="Is this the primary contact?"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Is this contact still active?"
                    ),
                ),
                (
                    "receive_purchase_orders",
                    models.BooleanField(
                        default=False, help_text="Send purchase orders to this contact"
                    ),
                ),
                (
                    "receive_invoices",
                    models.BooleanField(
                        default=False,
                        help_text="Send invoice-related communications to this contact",
                    ),
                ),
                (
                    "receive_quality_notices",
                    models.BooleanField(
                        default=False,
                        help_text="Send quality notifications to this contact",
                    ),
                ),
                (
                    "preferred_contact_method",
                    models.CharField(
                        choices=[
                            ("EMAIL", "Email"),
                            ("PHONE", "Phone"),
                            ("MOBILE", "Mobile"),
                        ],
                        default="EMAIL",
                        help_text="Preferred method of contact",
                        max_length=20,
                    ),
                ),
                (
                    "language_preference",
                    models.CharField(
                        default="EN",
                        help_text="Language preference (ISO code)",
                        max_length=10,
                    ),
                ),
                (
                    "notes",
                    models.TextField(blank=True, help_text="Notes about this contact"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_vendor_contacts",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "vendor",
                    models.ForeignKey(
                        help_text="Vendor this contact belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="contacts",
                        to="supplychain.vendor",
                    ),
                ),
            ],
            options={
                "verbose_name": "Vendor Contact",
                "verbose_name_plural": "Vendor Contacts",
                "db_table": "vendor_contacts",
                "ordering": ["vendor__name", "last_name", "first_name"],
            },
        ),
        migrations.AddField(
            model_name="purchaseorder",
            name="vendor_contact",
            field=models.ForeignKey(
                blank=True,
                help_text="Vendor contact person",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="purchase_orders",
                to="supplychain.vendorcontact",
            ),
        ),
        migrations.CreateModel(
            name="VendorInvoice",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "invoice_number",
                    models.CharField(
                        db_index=True,
                        help_text="Internal invoice number (auto-generated: INV-YYYY-######)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "vendor_invoice_number",
                    models.CharField(
                        help_text="Vendor's invoice number", max_length=100
                    ),
                ),
                ("invoice_date", models.DateField(help_text="Invoice date")),
                ("due_date", models.DateField(help_text="Payment due date")),
                (
                    "received_date",
                    models.DateField(help_text="Date invoice was received"),
                ),
                (
                    "currency_code",
                    models.CharField(default="USD", help_text="Currency", max_length=3),
                ),
                (
                    "subtotal_amount",
                    models.DecimalField(
                        decimal_places=2, help_text="Subtotal before tax", max_digits=15
                    ),
                ),
                (
                    "tax_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Tax amount",
                        max_digits=15,
                    ),
                ),
                (
                    "shipping_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Shipping/freight",
                        max_digits=15,
                    ),
                ),
                (
                    "other_charges",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Other charges",
                        max_digits=15,
                    ),
                ),
                (
                    "total_amount",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Total invoice amount",
                        max_digits=15,
                    ),
                ),
                (
                    "amount_paid",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Amount paid so far",
                        max_digits=15,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Review"),
                            ("MATCHED", "Matched to PO/Receipt"),
                            ("MATCH_EXCEPTION", "Matching Exception"),
                            ("APPROVED", "Approved for Payment"),
                            ("REJECTED", "Rejected"),
                            ("PAID", "Paid"),
                            ("PARTIALLY_PAID", "Partially Paid"),
                        ],
                        db_index=True,
                        default="PENDING",
                        help_text="Invoice status",
                        max_length=20,
                    ),
                ),
                (
                    "is_matched",
                    models.BooleanField(
                        default=False, help_text="Has invoice been matched?"
                    ),
                ),
                (
                    "match_exception_reason",
                    models.TextField(
                        blank=True, help_text="Reason for match exception"
                    ),
                ),
                (
                    "approved_at",
                    models.DateTimeField(
                        blank=True, help_text="When approved", null=True
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="Notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who approved",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="approved_vendor_invoices",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_vendor_invoices",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "payment_term",
                    models.ForeignKey(
                        blank=True,
                        help_text="Payment terms",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="vendor_invoices",
                        to="supplychain.paymentterm",
                    ),
                ),
                (
                    "purchase_order",
                    models.ForeignKey(
                        help_text="Related purchase order",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="vendor_invoices",
                        to="supplychain.purchaseorder",
                    ),
                ),
                (
                    "vendor",
                    models.ForeignKey(
                        help_text="Vendor who sent invoice",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="vendor_invoices",
                        to="supplychain.vendor",
                    ),
                ),
            ],
            options={
                "verbose_name": "Vendor Invoice",
                "verbose_name_plural": "Vendor Invoices",
                "db_table": "vendor_invoices",
                "ordering": ["-invoice_date"],
            },
        ),
        migrations.CreateModel(
            name="InvoiceMatch",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "match_status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Match"),
                            ("MATCHED", "Matched"),
                            ("EXCEPTION", "Exception"),
                            ("RESOLVED", "Exception Resolved"),
                        ],
                        default="PENDING",
                        help_text="Match status",
                        max_length=20,
                    ),
                ),
                (
                    "price_variance",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Price variance (Invoice - PO)",
                        max_digits=15,
                    ),
                ),
                (
                    "quantity_variance",
                    models.DecimalField(
                        decimal_places=3,
                        default=Decimal("0.000"),
                        help_text="Quantity variance",
                        max_digits=10,
                    ),
                ),
                (
                    "price_variance_percent",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Price variance percentage",
                        max_digits=5,
                    ),
                ),
                (
                    "match_date",
                    models.DateTimeField(
                        blank=True, help_text="When match was performed", null=True
                    ),
                ),
                (
                    "exception_notes",
                    models.TextField(blank=True, help_text="Notes on exception"),
                ),
                (
                    "resolution_notes",
                    models.TextField(
                        blank=True, help_text="How exception was resolved"
                    ),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True, help_text="When exception was resolved", null=True
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "match_performed_by",
                    models.ForeignKey(
                        help_text="User who performed match",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_matches_performed",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "resolved_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who resolved exception",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_matches_resolved",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "purchase_order",
                    models.ForeignKey(
                        help_text="PO being matched",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="invoice_matches",
                        to="supplychain.purchaseorder",
                    ),
                ),
                (
                    "receipt",
                    models.ForeignKey(
                        blank=True,
                        help_text="Receipt being matched",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_matches",
                        to="supplychain.receipt",
                    ),
                ),
                (
                    "vendor_invoice",
                    models.ForeignKey(
                        help_text="Invoice being matched",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="matches",
                        to="supplychain.vendorinvoice",
                    ),
                ),
            ],
            options={
                "verbose_name": "Invoice Match",
                "verbose_name_plural": "Invoice Matches",
                "db_table": "invoice_matches",
            },
        ),
        migrations.CreateModel(
            name="InvoiceLine",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("line_number", models.IntegerField(help_text="Line sequence number")),
                (
                    "description",
                    models.CharField(help_text="Item description", max_length=500),
                ),
                (
                    "quantity",
                    models.DecimalField(
                        decimal_places=3, help_text="Quantity invoiced", max_digits=10
                    ),
                ),
                (
                    "unit_price",
                    models.DecimalField(
                        decimal_places=4, help_text="Unit price", max_digits=12
                    ),
                ),
                (
                    "line_total",
                    models.DecimalField(
                        decimal_places=2, help_text="Line total", max_digits=15
                    ),
                ),
                (
                    "variance_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Variance from PO (if any)",
                        max_digits=15,
                    ),
                ),
                (
                    "variance_reason",
                    models.TextField(blank=True, help_text="Reason for variance"),
                ),
                ("notes", models.TextField(blank=True, help_text="Line notes")),
                (
                    "po_line",
                    models.ForeignKey(
                        blank=True,
                        help_text="Matched PO line",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_lines",
                        to="supplychain.purchaseorderline",
                    ),
                ),
                (
                    "receipt_line",
                    models.ForeignKey(
                        blank=True,
                        help_text="Matched receipt line",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_lines",
                        to="supplychain.receiptline",
                    ),
                ),
                (
                    "vendor_invoice",
                    models.ForeignKey(
                        help_text="Parent invoice",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="lines",
                        to="supplychain.vendorinvoice",
                    ),
                ),
            ],
            options={
                "db_table": "invoice_lines",
                "ordering": ["vendor_invoice", "line_number"],
            },
        ),
        migrations.CreateModel(
            name="CostAllocation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "allocation_number",
                    models.CharField(
                        db_index=True,
                        help_text="Unique allocation number (auto-generated: COST-YYYY-####)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "cost_type",
                    models.CharField(
                        choices=[
                            ("MATERIAL", "Material Cost"),
                            ("LABOR", "Labor Cost"),
                            ("OVERHEAD", "Overhead Cost"),
                            ("EQUIPMENT", "Equipment Cost"),
                            ("SUBCONTRACTOR", "Subcontractor Cost"),
                            ("OTHER", "Other Cost"),
                        ],
                        help_text="Type of cost",
                        max_length=20,
                    ),
                ),
                (
                    "description",
                    models.CharField(help_text="Cost description", max_length=500),
                ),
                (
                    "cost_amount",
                    models.DecimalField(
                        decimal_places=2, help_text="Cost amount", max_digits=12
                    ),
                ),
                (
                    "currency_code",
                    models.CharField(default="USD", help_text="Currency", max_length=3),
                ),
                (
                    "gl_account_code",
                    models.CharField(
                        blank=True, help_text="GL account code", max_length=50
                    ),
                ),
                (
                    "posted_to_gl",
                    models.BooleanField(
                        default=False, help_text="Has been posted to GL?"
                    ),
                ),
                (
                    "gl_posting_date",
                    models.DateField(
                        blank=True, help_text="GL posting date", null=True
                    ),
                ),
                ("cost_date", models.DateField(help_text="Date of cost")),
                ("notes", models.TextField(blank=True, help_text="Notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_cost_allocations",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "drill_bit",
                    models.ForeignKey(
                        blank=True,
                        help_text="Related drill bit",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="cost_allocations",
                        to="workorders.drillbit",
                    ),
                ),
                (
                    "work_order",
                    models.ForeignKey(
                        help_text="Work order to allocate cost to",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="cost_allocations",
                        to="workorders.workorder",
                    ),
                ),
                (
                    "expense_category",
                    models.ForeignKey(
                        help_text="Expense category",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="cost_allocations",
                        to="supplychain.expensecategory",
                    ),
                ),
                (
                    "purchase_order",
                    models.ForeignKey(
                        blank=True,
                        help_text="Source purchase order",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="cost_allocations",
                        to="supplychain.purchaseorder",
                    ),
                ),
                (
                    "vendor_invoice",
                    models.ForeignKey(
                        blank=True,
                        help_text="Source vendor invoice",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="cost_allocations",
                        to="supplychain.vendorinvoice",
                    ),
                ),
            ],
            options={
                "verbose_name": "Cost Allocation",
                "verbose_name_plural": "Cost Allocations",
                "db_table": "cost_allocations",
                "ordering": ["-cost_date"],
            },
        ),
        migrations.CreateModel(
            name="VendorPayment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "payment_number",
                    models.CharField(
                        db_index=True,
                        help_text="Unique payment number (auto-generated: PAY-YYYY-######)",
                        max_length=50,
                        unique=True,
                    ),
                ),
                ("payment_date", models.DateField(help_text="Payment date")),
                (
                    "payment_method",
                    models.CharField(
                        choices=[
                            ("CHECK", "Check"),
                            ("WIRE_TRANSFER", "Wire Transfer"),
                            ("ACH", "ACH Transfer"),
                            ("CREDIT_CARD", "Credit Card"),
                            ("CASH", "Cash"),
                            ("OTHER", "Other"),
                        ],
                        help_text="Payment method",
                        max_length=20,
                    ),
                ),
                (
                    "payment_amount",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Total payment amount",
                        max_digits=15,
                    ),
                ),
                (
                    "currency_code",
                    models.CharField(default="USD", help_text="Currency", max_length=3),
                ),
                (
                    "check_number",
                    models.CharField(
                        blank=True,
                        help_text="Check number if payment by check",
                        max_length=50,
                    ),
                ),
                (
                    "transaction_reference",
                    models.CharField(
                        blank=True,
                        help_text="Transaction reference number",
                        max_length=100,
                    ),
                ),
                (
                    "bank_account",
                    models.CharField(
                        blank=True, help_text="Bank account used", max_length=100
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending"),
                            ("PROCESSING", "Processing"),
                            ("COMPLETED", "Completed"),
                            ("FAILED", "Failed"),
                            ("CANCELLED", "Cancelled"),
                        ],
                        db_index=True,
                        default="PENDING",
                        help_text="Payment status",
                        max_length=20,
                    ),
                ),
                (
                    "posted_to_gl",
                    models.BooleanField(
                        default=False, help_text="Has been posted to GL?"
                    ),
                ),
                (
                    "gl_posting_date",
                    models.DateField(
                        blank=True, help_text="GL posting date", null=True
                    ),
                ),
                ("notes", models.TextField(blank=True, help_text="Payment notes")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_vendor_payments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "vendor",
                    models.ForeignKey(
                        help_text="Vendor receiving payment",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="payments",
                        to="supplychain.vendor",
                    ),
                ),
            ],
            options={
                "verbose_name": "Vendor Payment",
                "verbose_name_plural": "Vendor Payments",
                "db_table": "vendor_payments",
                "ordering": ["-payment_date"],
            },
        ),
        migrations.CreateModel(
            name="PaymentAllocation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "allocated_amount",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Amount allocated to this invoice",
                        max_digits=15,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "vendor_invoice",
                    models.ForeignKey(
                        help_text="Invoice being paid",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="payment_allocations",
                        to="supplychain.vendorinvoice",
                    ),
                ),
                (
                    "payment",
                    models.ForeignKey(
                        help_text="Payment",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="allocations",
                        to="supplychain.vendorpayment",
                    ),
                ),
            ],
            options={
                "verbose_name": "Payment Allocation",
                "verbose_name_plural": "Payment Allocations",
                "db_table": "payment_allocations",
            },
        ),
        migrations.AddIndex(
            model_name="purchaserequisition",
            index=models.Index(
                fields=["requisition_number"], name="purchase_re_requisi_beecfb_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="purchaserequisition",
            index=models.Index(fields=["status"], name="purchase_re_status_fcea54_idx"),
        ),
        migrations.AddIndex(
            model_name="purchaserequisition",
            index=models.Index(
                fields=["requested_by", "status"], name="purchase_re_request_00d342_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="purchaserequisitionline",
            unique_together={("requisition", "line_number")},
        ),
        migrations.AlterUniqueTogether(
            name="receiptline",
            unique_together={("receipt", "line_number")},
        ),
        migrations.AddIndex(
            model_name="vendor",
            index=models.Index(
                fields=["vendor_code"], name="vendors_vendor__656704_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendor",
            index=models.Index(
                fields=["status", "qualification_level"],
                name="vendors_status_51d199_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="vendor",
            index=models.Index(
                fields=["vendor_type", "status"], name="vendors_vendor__953f40_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendor",
            index=models.Index(fields=["name"], name="vendors_name_a8eecc_idx"),
        ),
        migrations.AddIndex(
            model_name="receipt",
            index=models.Index(
                fields=["receipt_number"], name="receipts_receipt_0f1a0f_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="receipt",
            index=models.Index(
                fields=["purchase_order", "status"], name="receipts_purchas_4551d1_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="receipt",
            index=models.Index(
                fields=["receipt_date"], name="receipts_receipt_eac4d1_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorcontact",
            index=models.Index(
                fields=["vendor", "is_primary"], name="vendor_cont_vendor__9161c1_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorcontact",
            index=models.Index(
                fields=["vendor", "contact_type"], name="vendor_cont_vendor__a0d1c3_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorcontact",
            index=models.Index(fields=["email"], name="vendor_cont_email_341f91_idx"),
        ),
        migrations.AddIndex(
            model_name="purchaseorder",
            index=models.Index(
                fields=["po_number"], name="purchase_or_po_numb_5dbf6d_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="purchaseorder",
            index=models.Index(
                fields=["vendor", "status"], name="purchase_or_vendor__d78b00_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="purchaseorder",
            index=models.Index(
                fields=["order_date"], name="purchase_or_order_d_37e39f_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="purchaseorder",
            index=models.Index(fields=["status"], name="purchase_or_status_3f9c03_idx"),
        ),
        migrations.AddIndex(
            model_name="vendorinvoice",
            index=models.Index(
                fields=["invoice_number"], name="vendor_invo_invoice_52baa5_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorinvoice",
            index=models.Index(
                fields=["vendor", "status"], name="vendor_invo_vendor__00cf6a_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorinvoice",
            index=models.Index(
                fields=["due_date", "status"], name="vendor_invo_due_dat_4a66fa_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="invoiceline",
            unique_together={("vendor_invoice", "line_number")},
        ),
        migrations.AddIndex(
            model_name="costallocation",
            index=models.Index(
                fields=["allocation_number"], name="cost_alloca_allocat_dc9b8c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="costallocation",
            index=models.Index(
                fields=["work_order", "cost_type"],
                name="cost_alloca_work_or_065da8_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="costallocation",
            index=models.Index(
                fields=["cost_date"], name="cost_alloca_cost_da_01f01c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorpayment",
            index=models.Index(
                fields=["payment_number"], name="vendor_paym_payment_5616ac_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorpayment",
            index=models.Index(
                fields=["vendor", "status"], name="vendor_paym_vendor__420cb4_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="vendorpayment",
            index=models.Index(
                fields=["payment_date"], name="vendor_paym_payment_8df1d3_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="paymentallocation",
            unique_together={("payment", "vendor_invoice")},
        ),
    ]
